---
bibliography: 
    - /home/luke/Documents/bibliography/bib/bib-db/nefaDiabetes.bib
    - /home/luke/Documents/bibliography/bib/bib-db/myrefs.bib
csl:
    - /home/luke/Documents/bibliography/styles/american-medical-association-no-et-al.csl
output:
    word_document:
      reference_docx: /home/luke/Templates/journal-templates/ajcn-template.docx
      fig_height: 6 
      fig_width: 5 
      fig_caption: true
---

# Title page #

Title:

Author:

Affiliations:

Disclaimers:

Correspondence:

Funding support:

# Abstract #

<!-- outline

Overall story: while nefa are known risk factors for diabetes, not sure about
the composition. we find that the composition doesn't matter so much as the
overall pool, specific to BCD. however, 16:0, etc, are the only two fa that have
an assoc, suggesting that irrespective of other fa increases or decreases, these
two fa are the fa that contribute to the harm seen in the overall nefa. using
cluster analysis, we see that those with low bcd have a pattern of fa that skews
to higher amounts of 16:0 etc and marginally less in other fa (maybe not enough
to observe on an individual scale). while other studies have seen a role of nefa
in ir, we do not. while this warrants further longitudinal research, this may
suggest that given prev studies on ir have been acute in nature, over the long
term the role of nefa on ir may not be substantial. this duality in nefa is also
seen in bcd, where acutely it improves bc, but chronically no.

Possible reason why IR is not shown... other studies have been cross-sectional..
Thus a potential confounder is the role that obesity plays in IR and IR on FFA
release... So, longitudinally, FFA would not predict IR since it is IR that is
suppressing NEFA.

Popular hypothesis: obese -> FFA -> IR.. may not be the case

total nefa evidence, well-studied. but there is diversity. no studies on it.

Some evidence to suggest that FFA delivery may be higher in obese, but that conc
may or may not be. Also that research on increasing FFA and IR comes from
experimental (probably fairly short term) research.

Association between higher FFA and muscle/hepatic IR, but challenging as adipose
tissue can also be IR. So is it the higher FFA -> IR or is it IR -> FFA?

methods -> gee, then lda (or similar) to confirm the role of 16:0 etc rather
than any individual FA

- as GEE results suggest that % does nothing, but in conc 16:0 etc has assoc...
is it that 16:0 is harmful or is it the pool? is it that as 16:0 inc, there is
harm, irrespective of whether other FA increase or decrease as well?
- need to do LDA or some such to id the pattern of why... (don't show this in
paper, but examine PCA of it too)

figs/tabs: 
- tab:basic char
- fig:distr
- fig:nefaCorr (sup?)
- fig:varCorr (sup?)
- fig:geeconc%
- fig:lda

supfigs/tabs:
- tab:geeconc%
- tab:distr

THOUGHTS:

- sleep restriction can impact NEFA, but only higher during night and a bit
during early-morning. Should keep this in mind.
- Adjust for TAG in IR models?

-->

```{r setup, collapse=TRUE}
knitr::opts_knit$set(root.dir = '../')
knitr::opts_chunk$set(echo = FALSE)
```

```{r loadData, message=FALSE}
source('.Rprofile')
suppressMessages(run_setup())
load_data()
dim(ds)
```

```{r caption_setup}
## Include captions below using `captioner` package
fig <- captioner(prefix = 'Figure')
cite_f <- pryr::partial(fig, display = 'cite')
sfig <- captioner(prefix = 'Supplementary Figure')
cite_sf <- pryr::partial(sfig, display = 'cite')
tab <- captioner(prefix = 'Table')
cite_t <- pryr::partial(tab, display = 'cite')
stab <- captioner(prefix = 'Supplementary Table')
cite_st <- pryr::partial(stab, display = 'cite')
# usage: cite_st('basicChar')

tab_basic <- tab('basicChar', 'Basic characteristics of the PROMISE participants at each of the 3 time points.')
fig_dist <- fig('nefaDist', 'Concentrations (nmol/mL) of each non-esterified fatty acid in PROMISE participants at the baseline visit (2004-2006)')
fig_gee <- fig('gee', 'Longitudinal associations of individual non-esterified fatty acids (mol% and nmol/mL) with insulin sensitivity and beta-cell function using generalized estimating equations over the 6 years in the PROMISE cohort.  Adjusted for {{covariates}}. Outcome variables were log-transformed, predictor variables were scaled, and x-axis values were exponentiated to represent percent difference per SD increase in the fatty acid.  P-values presented were adjusted for the false discovery rate.')
```


# Background #

Three paragraphs:

1. Total NEFA on diabetes, pathology, evidence
2. NEFA diverse, individual NEFA on pathology, bit more evidence from total, go
into experimental of species
3. Limitations, gaps, inconsistencies, objectives and hypotheses

# Subjects and Methods #

The Prospective Metabolism and Islet cell Evaluation (PROMISE) cohort is a
longitudinal observational study of participants with one or more risk factors
for type 2 diabetes mellitus, including obesity, hypertension, family history of
diabetes, and/or a history of gestational diabetes or birth of a macrosomic 
infant.  Participants aged 30 years and older were recruited for the baseline
visit from Toronto and London, Ontario, Canada into the PROMISE cohort (n=736) 
between 2004-2006.  Follow-up examinations occur every three years, with
currently three examination visits completed to date (2004-2006, 2007-2009, and
2010-2013).  The current study used data on participants who did not have
diabetes at baseline, who returned for one or more follow-up examinations, and
who had samples available for fatty acid measurements (n=477).  A diagram of the
sample size at each visit is shown in `r supFigRef('flow')`.  At each
examination, participants undergo extensive metabolic characterization, 
anthropometric measurements, and structured questionnaires on lifestyle and
sociodemographics.  Research ethics approval was obtained from Mount Sinai
Hospital and the University of Western Ontario.  Data collection methods were
standardized across the 2 centres and research nurses were centrally trained. 
<!--Over the 6-yrs, {{n return each visit}} returned for the 6-yr clinic visit 
({{pct loss to followup}}% loss to follow-up).  By the 6-yr visit, {{n converted
to IFG}} converted into IFG, {{n converted to IGT}} converted into IGT, and {{n
converted to DM}} into diabetes.-->

## Blood measure assessment

At each clinic examination, participants had an 7-12 hour fasting blood sample 
taken and then had a 75g oral glucose tolerance test (OGTT) with a 30 minute and
2 hour blood draw. All blood samples were processed and frozen at -70°C. Alanine
aminotransferase (ALT) was measured using standard laboratory procedures. 
Cholesterol, HDL, and triacylglycerols (TAG) were measured using Roche Modular's
enzymatic colometric tests (Mississauga, ON).  Both specific insulin and glucose
were derived from the OGTT at fasting, 30 minute, and 2 hour time points. 
Specific insulin was measured using the Elecsys 1010 (Roche Diagnostics, Basel, 
Switzerland) immunoassay analyzer and electrochemiluminescence immunoassay. 
This assay shows 0.05% cross-reactivity to intact human pro-insulin and the Des
31,32 circulating split form (Linco Res. Inc), and has a CV of 9.3%.  Glucose
was determined using an enzymatic hexokinase (Roche Modular, Roche Diagnostics)
with a detection range of 0.11 (2 mg/dL) to 41.6 mmol/L.  The inter-assay %CV is
<1.1% and intra-assay %CV is < 1.9%.  All assays were performed at the Banting 
and Best Diabetes Centre Core Lab at the University of Toronto. Impaired fasting
glucose (IFG), impaired glucose tolerance (IGT), and diabetes were categorized
using the 2006 WHO criteria [@WHO2006].

NEFA composition was quantified using stored fasting serum samples from the
baseline visit, which had been frozen at -70°C for 4-6 years and had not been
exposed to any freeze-thaw cycles.  Serum fatty acids have been documented to be
stable at these temperatures for up to 10 years [@Matthan2010a]. A known amount
of {{internal standard name}} (17:0) was added to the serum as an internal 
standard prior to extracting total lipids according to the method of Folch
[@Folch1957a].  Each serum lipid fraction was isolated using thin layer 
chromatography, which were  visualized under UV light after lightly spraying 
with 8-anilino-1-naphthalene sulfonic acid (0.1% wt/vol) and then converted to
fatty acid methyl esters with 14% boron trifluoride in methanol at 100°C for 1
h.  Fatty acid methyl esters were separated and quantified using a Varian-430
gas chromatograph (Varian, Lake Forest, CA, USA) equipped with a Varian Factor
Four capillary column (VF-23ms; 30 m × 0.25 mm i.d. × 0.25 μm film thickness)
and a flame ionization detector, which were injected in splitless mode. Fatty
acid concentrations (nmol/ml) were calculated by proportional comparison of gas
chromatography peak areas to that of the internal standards [@Nishi2014a;
@Chen2011a].  There were 22 fatty acids measured in the NEFA fraction.

## Outcome variables

Insulin sensitivity and beta-cell function indices were computed using the OGTT
glucose and insulin.  Insulin sensitivity was assessed using the inverted
homeostasis model assessment of insulin resistance (1/HOMA-IR) [@Matthews1985]
and the Insulin Sensitivity Index (ISI) [@Matsuda1999]. HOMA-IR largely reflects
hepatic insulin resistance, while ISI reflects whole-body insulin sensitivity
[@AbdulGhani2007].  Beta-cell function was assessed using the Insulinogenic
Index [@Wareham1995] over HOMA-IR (IGI/IR) and the Insulin Secretion-Sensitivity
Index-2 (ISSI-2) [@Retnakaran2009]. IGI/IR is a measure of the first phase
insulin secretion while ISSI-2 is analogous to the disposition index. Each index
has been validated against gold standard measures [@Matthews1985; @Matsuda1999;
@Retnakaran2009].

## Anthropometrics and sociodemographics

Height, weight, and waist circumference (WC) were measured at all clinic
examinations using standard procedures.  WC was measured at the natural waist,
defined as the narrowest part of the torso between the umbilicus and the xiphoid
process.  Height was measured using a stadiometer and weight was measured on a 
medical balance beam scale. BMI was calculated by dividing weight (kg) by height
(m) squared. Sociodemographic information, such as age, sex, and ethnicity, were
determined using standardized questionnaires administered at each examination
visit.

## Statistical analysis

The primary outcome variables for the PROMISE cohort and this analyses were 
1/HOMA-IR, ISI, IGI/IR, and ISSI-2; outcome variables were log-transformed for
the statistical modeling. The primary predictor variables for this study were
the 22 NEFA as a mole percent (mol%) of the total fraction and as a 
concentration (nmol/mL). 

Pearson correlation coefficients were computed for the PL and CE fatty acids
with other continuous variables. {{keep??}}

For the primary analysis, generalized estimating equation (GEE) models 
[@Zeger1986a] were used to determine the longitudinal associations between the 
outcome variables and the predictor variables.  Given the longitudinal design
and auto-regressive (AR1) correlation matrix was chosen for the GEE models,
though other matrices (eg. exchangeable) had similar fit (data not shown)
{{confirm}}. GEE is well suited to cohort studies given it's capacity to handle
missed visits. The predictor variables and continuous covariates were scaled 
(mean centered and standardized). The NEFA variables were classified as 
*time-independent* (held constant) as they were measured only at the baseline 
visit, while the outcome variables and covariates were set as *time-dependent*. 
No imputation was conducted on missing values.

Covariates selection was based on previous literature, suggestions from directed
acyclic graph modeling [@Greenland1999a], and the quasi-likelihood information
criterion (QIC). Various models compared using QIC are shown in **`r supTabRef('tabQIC')`**.  
The final GEE model (M#) we selected had time, sex,
ethnicity, baseline age, waist circumference, {{...}}, and family history of
diabetes as covariates.  GEE parameter estimates were exponentiated.
<!--(exponentiated, minus 1, and multiplied by 100)--> After scaling,
log-transforming, and exponentiating, the GEE parameter estimates are
interpreted as an expected percent difference in the outcome variable for every
SD increase in the predictor variable given the covariates are held constant. 
An time by predictor term was included in each of the GEE models to test for
time interactions.

Sensitivity analysis adjusting for clinically measured TG, as TG at the 6 year
visit was only done on a subset of participants.

While the GEE modeling takes into consideration the longitudinal design of the
data, a limitation is that it can not analyze the inherent multivariate nature
of the composition of the NEFA fraction. As such, after running the GEE models
for the longitudinal analysis, linear discriminant analysis (LDA) {{or QDA}} was
used to identify the patterns of NEFA composition for tertiles of the metabolic
disorders. LDA is not suited for longitudinal data and so only the baseline
visit data was used and only the outcome and predictor variables could be
included in the analysis. Data from the later visit dates were used to confirm
the results of the LDA analysis.

All statistical tests were computed using R `r getRversion()`
[@Rbase], along with the R packages geepack `r packageVersion('geepack')` for
the GEE modeling [@Hoejsgaard2006a] and MASS `r packageVersion('MASS')` for LDA.
The R code for this manuscript is available at {{link}}. Results were
statistically significance at p<0.05, after adjusting for the False Discovery
Rate [@Benjamini1995a] for multiple testing.

# Results

```{r geeData, cache=TRUE}

outcomes_is <- c('linvHOMA', 'lISI')
outcomes_bcf <- c('lIGIIR', 'lISSI2')
outcomes <- c(outcomes_is, outcomes_bcf)
ne_pct <- grep('^pct_ne', names(ds), value = TRUE)
ne_conc <- c('ne_Total', grep('^ne\\d\\d', names(ds), value = TRUE))
covariates_is <- c('VN', 'Waist', 'Sex', 'Ethnicity', 'BaseAge', 'ALT')
covariates_bcf <- c('VN', 'Waist', 'Sex', 'Ethnicity', 'BaseAge', 'ALT', 
                    'MET', 'AlcoholPerWk')

gee_df <- get_gee_data(ds)
gee_results <- bind_rows(
    analyze_gee(gee_df, outcomes_is, ne_pct, covariates_is, 'mol%', adj.p = TRUE),
    analyze_gee(gee_df, outcomes_is, ne_conc, covariates_is, 'nmol/mL', adj.p = TRUE),
    analyze_gee(gee_df, outcomes_bcf, ne_pct, covariates_bcf, 'mol%', adj.p = TRUE),
    analyze_gee(gee_df, outcomes_bcf, ne_conc, covariates_bcf, 'nmol/mL', adj.p = TRUE)
    ) 

gee_results_unadj <- bind_rows(
    analyze_gee(gee_df, outcomes, ne_pct, 'VN', 'mol%', adj.p = TRUE),
    analyze_gee(gee_df, outcomes, ne_conc, 'VN', 'nmol/mL', adj.p = TRUE)
    ) %>% 
    mutate(Yterms = factor(Yterms, unique(Yterms)))
```

```{r ldaData}
# include also the 3-yr and 6-yr data for training/testing.
lda_df <- ds %>%
    filter(VN == 0) %>%
    mutate(BCF = rstatsToolkit::aide.tertile(lISSI2) %>%
               factor(., labels = c('1st tertile: log(ISSI-2)', 
                                    '2nd tertile: log(ISSI-2)', 
                                    '3rd tertile: log(ISSI-2)'), 
                      ordered = TRUE)) %>%
    select(BCF, matches('^ne\\d\\d')) %>%
    mutate_each(funs(as.numeric(scale(.))), -BCF) %>%
    na.omit() %>% 
    arrange(BCF)
lda_results <- lda(BCF ~ ., data = lda_df)
```


```{r resultsInline, dependson='geeData'}
# extract gee beta coefficient for indicating magnitude
pctChg.o <- ds %>%
  select(f.VN, HOMA, ISI, IGIIR, ISSI2) %>%
  gather(Measure, Value, -f.VN) %>%
  na.omit() %>%
  group_by(Measure, f.VN) %>%
  summarise(med = median(Value)) %>%
  spread(f.VN, med) %>%
  mutate(pctChg = ((`6-yrs` - `0-yr`) / `0-yr`) * 100) %>%
  select(pctChg) %>%
  abs() %>%
  round(1) %>%
  {paste0(min(.), '% to ', max(.), '%')}

cumPctPL <- calcCumPctFA(ds, 'pct_pl', 90)
calcCumPctFA <- function(data, variable.pattern, filter.value) {
    data %>%
      filter(VN == 0) %>%
      select(matches(variable.pattern)) %>%
      gather(fat, value) %>%
      group_by(fat) %>%
      summarise(pct = mean(value, na.rm = TRUE)) %>%
      arrange(desc(pct)) %>%
      mutate(cumpct = cumsum(pct) %>% round(1) %>% format(nsmall = 1),
             pct = round(pct, 1) %>% format(nsmall = 1)) %>%
      filter(cumpct <= filter.value)
}
extractBeta <- function(data) {
    data %>%
      mutate(estCI = paste0('(beta: ', trim(format(round(estimate, 1), nsmall = 1)),
                            ' CI: ',
                            trim(format(round(conf.low, 1), nsmall = 1)),
                            ', ',
                            trim(format(round(conf.high, 1), nsmall = 1)),
                            ')'),
             #indep.estCI = paste(indep, estCI),
             #dep = paste(dep %>% gsub('log\\((.*)\\)', '\\1', .), estCI),
             dep = paste(dep %>% gsub('log\\((.*)\\)', '\\1', .))
             ) %>%
      filter(p.value <= 0.05) %>%
      arrange(dep, desc(estimate)) %>%
      select(dep, indep, estCI)
}
```

## Basic characteristics of the PROMISE cohort

## Distribution of NEFA

## Correlations of NEFA with basic characteristics

## GEE

As shown in {{supFigGeeUnadj}}, several associations were seen in the unadjusted
GEE models, particularly for the concentration data. Full model adjustment
attenuated most of these associations, with total NEFA, 16:0, and 18:2n-6 (all
as nmol/mL) had negative associations between IGI/IR and ISSI-2 ({{figGee}}).
The magnitude of association for each of these variables was fairly consistent
for each beta-cell function measure. For every one SD decrease in any of these
three NEFA variables, there was a predicted {{magnitude}}% lower IGI/IR and a
{{magnitude}}% lower ISSI-2 at each clinic visit. None of the NEFA variables as
a mol% had any association with the outcomes.

Adjusting for TAG attenuates all associations with IGI/IR and ISSI-2 (data not
shown). This may be due to either or both of two factors, mediation of TAG on
the pathway between NEFA and beta-cell function or the lower sample size at the
6 year visit from the incomplete measurement of TAG due to cuts in funding.

There were no significant interaction effects between time and the individual
NEFA on any of the outcome measures (data not shown).

## Discriminant analysis



# Discussion

Brief overall conclusion...

Given we found associations with the nmol/mL data, but none in the mol% data,
this suggests to us that the total size of the NEFA fraction is more important
in the pathogenesis of diabetes than is the specific FA composition. A
limitation of the mol% data is the inherent dependency between the FA as an
increase in one FA by definition means other FA must decrease. In the context of
this dependency, the associations we found for 16:0 and 18:2n-6 as nmol/mL
suggests that these NEFA may be contributing to the harmful association seen for
the total NEFA fraction, irrespective of changes in the other NEFA.

We found that higher palmitic acid (16:0) and linoleic acid (18:2n-6) associated
with lower beta-cell function by {{number?}}. Expand on experimental studies,
pathology/biology, mechanisms, etc.

There is substantial experimental research on the role of increasing NEFA and
increasing IR {{cite}}. Two major limitation of these studies are that they tend
to be fairly short term ({{length of time}}) and they tend to increase NEFA to
supraphysiological concentrations {{confirm}}. Epidemiological research has also
shown a link between higher NEFA and higher IR {{cite}}. However, most of these
studies are cross-sectional in nature and can not address causal direction.
Adipose tissue can become insulin resistant and thus hormone-sensitive lipase
may not respond to the inhibitory action of insulin {{cite}}. As such, IR may
temporally occur sooner than elevations in blood NEFA. In this longitudinal
analysis, we saw no association between NEFA composition and neither hepatic IR
(HOMA-IR) nor whole-body insulin sensitivity (ISI). Possible explanations for
this could be that over several years NEFA does not influence hepatic or muscle
IR or that it is IR that elevates NEFA and as such NEFA would not predict IR
over time.

In the sensitivity analysis adjusting for TAG, all associations with beta-cell
function were attenuated. While there is strong experimental evidence on the
role of chronically elevated NEFA, particularly palmitic acid, on impaired
beta-cell function, within a free-living population NEFA may be mediating it's
association through TAG. In normal metabolism, NEFA enters the liver and assists
in the production of TAG that is to be processed into very-low density
lipoproteins (VLDL) {{cite}}. Elevated NEFA may be mediating it's association
through hypertriglyceridemia, a known risk factor for diabetes {{cite}}. A major
caveat with the TAG-adjusted GEE models is the reduced sample size in the 6 year
visit, as only a subset (n={{sample}}) of participants had TAG measured.

Comment on LDA analysis... ...LDA backs up some of the GEE model results,
showing weak discriminatory ability of the NEFA pattern on identifying beta-cell
function... ...While the overall discriminatory ability of the NEFA pattern was
poor, there were certain NEFA that loaded differently on each level of beta-cell
function....

Limitations, etc...

Final, brief conclusion...

## Acknowledgements ##

# References #

# Tables #

```{r tabBasic}
# table(ds$Ethnicity, ds$f.VN)
# table(ds$f.VN)
summary(ds$Sex)
ds %>%
    outline_table(c('ne_Total', 'HOMA', 'ISI', 'IGIIR', 'ISSI2',
                    'TAG', 'Chol', 'BMI', 'Waist', 'HDL', 'FamHistDiab',
                    'Age', 'Ethnicity', 'Sex', 'MET', 'IFG', 'IGT',
                    'DM'), 'f.VN') %>% 
#     add_rows(c('HOMA', 'ISI', 'IGIIR', 'ISSI2'), stat_medianIQR, digits = 1) %>% 
#     add_rows(c('TAG', 'Chol', 'HDL', 'ne_Total', 'BMI', 'Waist', 'Age'), 
#              stat_meanSD, digits = 1) %>% 
    add_rows(c('Ethnicity', 'Sex')) %>% 
    rename_rows(renaming_table_rows) %>%
    rename_columns('Measure', 'Baseline', '3-yr', '6-yr') %>%
    construct_table()

```

# Figures #

```{r figDist}
ds %>%
    filter(VN == 0) %>%
    select(SID, matches('^ne\\d')) %>%
    filter(complete.cases(.)) %>% 
    gather(Measure, Value, -SID) %>% 
    mutate(Measure = renaming_fa(Measure) %>% 
               gsub('ne_', '', .) %>%
               factor(., levels = unique(.))) %>% 
    spread(Measure, Value) %>% 
    select(-SID) %>% 
    trance('boxes_dots') %>% 
    visualize(dots = FALSE,
              xlab = 'Concentration (nmol/mL)',
              ylab = 'Non-esterified fatty acid') %>% 
    vision_simple() +
    theme(axis.ticks.y = element_blank())
```



```{r figGEE, dependson='geeData'}
forest_plot(gee_results)
```

```{r figLDA}
visualize(lda_results, 'means', label.rename.fun = renaming_fa) %>% 
    vision_simple() +
    labs(y = 'Non-esterified fatty acids',
         x = 'Standardized mean of the fatty acid (SD of the nmol/mL)')
```


# Supplemental Material #

```{r supFigGeeUnadj, dependson='geeData'}
forest_plot(gee_results_unadj)
```


```{r supTabQIC, eval=FALSE}

```

```{r supTabGEE}

```

