---
output: fost::diabetologia_manuscript
---

```{r setup, include=FALSE}
devtools::load_all()
set_options()
knitr::opts_chunk$set(dev = "png")

# Include captions below using `captioner` package via library(captioner)
sfig <- captioner::captioner(prefix = 'ESM Fig.')
cite_sf <- pryr::partial(sfig, display = 'cite')

sfig_consort <- sfig('consort', 'CONSORT diagram of sample size at each examination visit for the main PROMISE cohort in addition of the sample size determination for the present analysis.')
sfig_dag_isi <- sfig("dag_isi", "Directed acyclic graph taken from DAGitty (DAGitty.net) for the potential causal pathway between NEFA and ISI. DAGitty recommended a minimal adjustment of waist, sex, and MET (physical activity).")
sfig_dag_issi2 <- sfig("dag_issi2", "Directed acyclic graph taken from DAGitty (DAGitty.net) for the potential causal pathway between NEFA and ISSI-2. DAGitty recommended a minimal adjustment of waist, ethnicity, and MET (physical activity).")
sfig_corr_conc <- sfig('corr_conc', 'Pearson correlation heatmap of non-esterified fatty acids (*nmol/mL*) and basic PROMISE participant characteristics for the baseline visit (2004-2006). Darkness of the colour indicates the magnitude of the correlation, with orange indicating positive and blue indicating negative correlations.')
sfig_corr_pct <- sfig('corr_pct', 'Pearson correlation heatmap of non-esterified fatty acids (*mol%*) and basic PROMISE participant characteristics for the baseline visit (2004-2006). Darkness of the colour indicates the magnitude of the correlation, with orange indicating positive and blue indicating negative correlations.')
sfig_gee_adj_nowaist <- sfig('gee_adj_nowaist', 'Longitudinal associations of individual non-esterified fatty acids (mol% and nmol/mL) with insulin sensitivity and beta-cell function over the 6 years in the PROMISE cohort. Generalized estimating equation models were fully adjusted, *excluding waist circumference*. X-axis values represent a percent difference in the outcome per SD increase in the fatty acid. P-values were adjusted for the BH false discovery rate, with each increase in dot size and blackness representing a p-value significance of p>0.05, p<0.05, and p<0.01.')
```

# ESM Figures

![`r sfig_consort`](../img/flowDiagramSample.png)

![`r sfig_dag_isi`](../img/dagitty-isi.png)

![`r sfig_dag_issi2`](../img/dagitty-issi2.png)

```{r ESM_Fig4, fig.cap=sfig_corr_conc}
plot_corr_heatmap(corr_results_conc, unit = "nmol/mL")
```

```{r ESM_Fig5, fig.cap=sfig_corr_pct}
plot_corr_heatmap(corr_results_pct, unit = "mol%")
```

```{r ESM_Fig6, fig.cap=sfig_gee_adj_nowaist}
gee_results %>% 
    dplyr::filter(model == "Adjusted no waist") %>% 
    plot_gee_main()
```

